<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Dark Christmas Countdown</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap');

body, html {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: radial-gradient(circle at center, #050a05, #000);
  font-family: 'Orbitron', monospace;
}

canvas#bg {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}

#wrap {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  perspective: 1200px;
}

#countdown {
  display: flex;
  gap: 20px;
  font-size: clamp(40px, 8vw, 100px);
  font-weight: 900;
  color: #00ff88;
  text-shadow: 0 0 15px currentColor, 0 0 40px currentColor;
  transform-style: preserve-3d;
  transition: color 0.3s ease;
}

.block {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.unit {
  display: flex;
  gap: 6px;
}

.label {
  font-size: 14px;
  margin-top: 8px;
  opacity: 0.7;
  letter-spacing: 1.5px;
}

.digit {
  position: relative;
  width: 60px;
  height: 100px;
  overflow: hidden;
  border-radius: 10px;
  background: rgba(0,0,0,0.3);
  box-shadow: 0 0 15px rgba(0,255,100,0.5), inset 0 0 10px rgba(0,255,100,0.3);
}

.digit span {
  position: absolute;
  width: 100%;
  line-height: 100px;
  text-align: center;
  transition: transform 0.4s cubic-bezier(.4,0,.2,1), opacity 0.4s;
}

.old { transform: translateY(0); opacity: 1; }
.new { transform: translateY(120%); opacity: 0; }

.animate .old { transform: translateY(-120%) rotateX(45deg); opacity: 0; }
.animate .new { transform: translateY(0) rotateX(0deg); opacity: 1; }

#flash {
  position: fixed;
  inset: 0;
  background: white;
  opacity: 0;
  pointer-events: none;
  z-index: 10;
}
</style>
</head>

<body>

<canvas id="bg"></canvas>
<div id="wrap">
  <div id="countdown"></div>
</div>
<div id="flash"></div>

<script>
// ===== FULLSCREEN CLICK =====
document.addEventListener("click",()=>{document.documentElement.requestFullscreen?.()},{once:true});

// ===== BACKGROUND SNOW + LIGHT =====
const canvas=document.getElementById("bg");
const ctx=canvas.getContext("2d");
let w,h;
function resize(){w=canvas.width=innerWidth; h=canvas.height=innerHeight;}
window.addEventListener("resize",resize); resize();

const snowflakes=Array.from({length:250},()=>({
  x: Math.random()*w,
  y: Math.random()*h,
  r: Math.random()*2+0.5,
  s: Math.random()*1.5+0.3,
  d: Math.random()*w
}));

function drawSnow(){
  ctx.clearRect(0,0,w,h);
  snowflakes.forEach(f=>{
    f.y += f.s;
    if(f.y>h) {f.y=0; f.x=Math.random()*w;}
    ctx.fillStyle="rgba(255,255,255,0.8)";
    ctx.beginPath();
    ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(drawSnow);
}
drawSnow();

// ===== COUNTDOWN =====
const target=new Date(new Date().getFullYear(),11,23,22,0,0);
const totalTime=target-new Date();
const cd=document.getElementById("countdown");
const flash=document.getElementById("flash");

function digit(n){
  const d=document.createElement("div");
  d.className="digit";
  d.innerHTML=`<span class="old">${n}</span><span class="new">${n}</span>`;
  return d;
}

function block(label,count){
  const b=document.createElement("div");
  b.className="block";
  const u=document.createElement("div");
  u.className="unit";
  for(let i=0;i<count;i++) u.appendChild(digit("0"));
  const l=document.createElement("div");
  l.className="label";
  l.textContent=label;
  b.append(u,l);
  cd.appendChild(b);
  return u;
}

const units={
  d:block("NAP",3),
  h:block("Ã“RA",2),
  m:block("PERC",2),
  s:block("MP",2)
};

function updateDigit(d,v){
  const o=d.children[0], n=d.children[1];
  if(o.textContent===v) return;
  n.textContent=v;
  d.classList.add("animate");
  setTimeout(()=>{o.textContent=v; d.classList.remove("animate");},400);
}

let finished=false;

function update(){
  const now=new Date();
  let diff=target-now;
  if(diff<0) diff=0;

  const d=Math.floor(diff/86400000);
  const h=Math.floor(diff/3600000)%24;
  const m=Math.floor(diff/60000)%60;
  const s=Math.floor(diff/1000)%60;

  const map={
    d:d.toString().padStart(3,"0"),
    h:h.toString().padStart(2,"0"),
    m:m.toString().padStart(2,"0"),
    s:s.toString().padStart(2,"0")
  };

  for(const k in map){
    [...units[k].children].forEach((dig,i)=>updateDigit(dig,map[k][i]));
  }

  // Christmas colors: green -> red
  const ratio=diff/totalTime;
  const r=Math.floor(255*(1-ratio));
  const g=Math.floor(200*ratio+55);
  cd.style.color=`rgb(${r},${g},120)`;

  // Final flash + confetti vibe
  if(diff===0 && !finished){
    finished=true;
    flash.style.opacity=1;
    setTimeout(()=>flash.style.opacity=0,500);
  }
}

setInterval(update,16);
update();
</script>

</body>
</html>
